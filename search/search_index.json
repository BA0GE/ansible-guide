{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Ansible \u7cfb\u7edf\u5316\u6307\u5357","text":"<p>\u6b22\u8fce\u6765\u5230 Ansible \u7cfb\u7edf\u5316\u6307\u5357\u3002\u672c\u6587\u6863\u65e8\u5728\u63d0\u4f9b\u4e00\u4efd\u5177\u5907\u751f\u4ea7\u7ea7\u53c2\u8003\u4ef7\u503c\u7684 Ansible \u81ea\u52a8\u5316\u6df1\u5ea6\u53c2\u8003\u624b\u518c\u3002</p>"},{"location":"#_1","title":"\u9879\u76ee\u603b\u89c8","text":"<p>Ansible \u662f\u4e00\u6b3e \u65e0\u4ee3\u7406 (Agentless) \u7684\u81ea\u52a8\u5316\u8fd0\u7ef4\u5f15\u64ce\uff0c\u5b83\u5229\u7528 SSH \u534f\u8bae\u548c \u5e42\u7b49\u6027 (Idempotency) \u673a\u5236\uff0c\u5c06\u590d\u6742\u7684\u914d\u7f6e\u7ba1\u7406\u3001\u5e94\u7528\u90e8\u7f72\u548c\u4efb\u52a1\u7f16\u6392\u8fc7\u7a0b\u8f6c\u5316\u4e3a\u53ef\u8bfb\u6027\u6781\u9ad8\u7684 YAML \u5267\u672c (Playbooks)\u3002</p>"},{"location":"#_2","title":"\u6838\u5fc3\u7ae0\u8282","text":"<ul> <li>01 \u6838\u5fc3\u6982\u5ff5\u4e0e\u54f2\u5b66: \u7406\u89e3 Ansible \u67b6\u6784\u8bbe\u8ba1\u7684 \"Why\" \u548c \"How\"\u3002</li> <li>02 \u73af\u5883\u51c6\u5907: \u786c\u4ef6\u3001\u64cd\u4f5c\u7cfb\u7edf\u53ca\u8f6f\u4ef6\u4f9d\u8d56\u8981\u6c42\u3002</li> <li>03 \u6df1\u5ea6\u89e3\u6790: \u5e95\u5c42\u539f\u7406\u4e0e\u8fd0\u884c\u673a\u5236\u3002</li> <li>04 \u5206\u6b65\u5b9e\u6218\u6559\u7a0b: \u6a21\u5757\u5316\u7684\u5b9e\u65bd\u6307\u5357\u3002</li> <li>05 \u9ad8\u7ea7\u8c03\u4f18: \u6027\u80fd\u8c03\u4f18\u4e0e\u6700\u4f73\u5b9e\u8df5\u3002</li> <li>06 \u9519\u8bef\u4ee3\u7801\u7d22\u5f15: \u6545\u969c\u6392\u67e5\u4e0e\u9519\u8bef\u7801\u901f\u67e5\u3002</li> </ul>"},{"location":"01-concepts/","title":"01-\u6838\u5fc3\u6982\u5ff5\u4e0e\u54f2\u5b66 (Concept &amp; Philosophy)","text":"<p>\u672c\u7ae0\u76ee\u6807: \u7406\u89e3 Ansible \"\u4e3a\u4ec0\u4e48\" \u8fd9\u6837\u8bbe\u8ba1\uff0c\u4ee5\u53ca\u5b83\u4e0e\u4f20\u7edf\u811a\u672c\u601d\u7ef4\u7684\u533a\u522b\u3002</p>"},{"location":"01-concepts/#1-agentless-architecture","title":"1. \u65e0\u4ee3\u7406\u67b6\u6784 (Agentless Architecture)","text":"<p>\u5b9a\u4e49: Ansible \u4e0d\u9700\u8981\u50cf Puppet \u6216 Zabbix \u90a3\u6837\u5728\u88ab\u7ba1\u7406\u8282\u70b9 (Managed Nodes) \u4e0a\u5b89\u88c5\u5b88\u62a4\u8fdb\u7a0b (Agent)\u3002</p>"},{"location":"01-concepts/#_1","title":"\u6df1\u5ea6\u89e3\u6790\uff1a\u5e95\u5c42\u539f\u7406","text":"<ul> <li>\u901a\u4fe1\u673a\u5236: Ansible \u590d\u7528\u73b0\u6709\u7684 OpenSSH \u534f\u8bae\u3002\u5982\u679c\u4f60\u7684\u673a\u5668\u80fd\u901a\u8fc7 SSH \u8fde\u63a5\uff0c\u5b83\u5c31\u80fd\u88ab Ansible \u7ba1\u7406\u3002</li> <li>\u6267\u884c\u903b\u8f91: \u63a7\u5236\u8282\u70b9 (Control Node) \u5c06 \u6a21\u5757 (Module) \u4ee3\u7801\uff08\u901a\u5e38\u662f Python \u811a\u672c\uff09\u901a\u8fc7 SFTP/SCP \u63a8\u9001\u5230\u76ee\u6807\u8282\u70b9\u7684\u4e34\u65f6\u76ee\u5f55\uff08\u9ed8\u8ba4 <code>~/.ansible/tmp/</code>\uff09\uff0c\u6267\u884c\u5b8c\u6bd5\u540e\u81ea\u52a8\u5220\u9664\u3002</li> <li>\u6838\u5fc3\u4f18\u52bf: \u96f6\u8d44\u6e90\u9a7b\u7559\uff0c\u96f6\u653b\u51fb\u9762\u589e\u52a0\uff0c\u7acb\u5373\u4e0a\u624b\u3002</li> </ul>"},{"location":"01-concepts/#2-idempotency","title":"2. \u5e42\u7b49\u6027 (Idempotency)","text":"<p>\u5b9a\u4e49: \u65e0\u8bba\u6267\u884c\u591a\u5c11\u6b21\uff0c\u7ed3\u679c\u90fd\u662f\u4e00\u81f4\u7684\u3002</p>"},{"location":"01-concepts/#why-it-matters","title":"\u4e3a\u4ec0\u4e48\u5b83\u5f88\u91cd\u8981 (Why it matters)","text":"<ul> <li>\u811a\u672c\u601d\u7ef4: <code>mkdir /tmp/data</code> -&gt; \u7b2c\u4e8c\u6b21\u6267\u884c\u4f1a\u62a5\u9519 \"File exists\"\uff08\u6587\u4ef6\u5df2\u5b58\u5728\uff09\u3002</li> <li>Ansible \u601d\u7ef4: <code>state: directory</code> -&gt; \u7b2c\u4e00\u6b21\u521b\u5efa\uff1b\u7b2c\u4e8c\u6b21\u68c0\u6d4b\u5230\u5df2\u5b58\u5728\u5219 \u8df3\u8fc7 (Skipped)\uff08\u72b6\u6001\u663e\u793a\u4e3a <code>OK</code> \u800c\u975e <code>Changed</code>\uff09\u3002</li> </ul>"},{"location":"01-concepts/#_2","title":"\u5e95\u5c42\u5b9e\u73b0","text":"<p>\u6bcf\u4e2a\u6a21\u5757\u5728\u6267\u884c\u53d8\u66f4\u524d\uff0c\u4f1a\u5148\u6536\u96c6\u76ee\u6807\u7cfb\u7edf\u7684 \"Facts\"\uff08\u5f53\u524d\u72b6\u6001\uff09\uff0c\u5e76\u4e0e \"Desired State\"\uff08\u671f\u671b\u72b6\u6001\uff09\u8fdb\u884c\u5bf9\u6bd4\u3002\u53ea\u6709\u5f53\u4e24\u8005\u4e0d\u4e00\u81f4\u65f6\uff0c\u624d\u4f1a\u89e6\u53d1\u5b9e\u9645\u7684\u64cd\u4f5c (Action)\u3002</p>"},{"location":"01-concepts/#3-workflow-visualization","title":"3. \u5de5\u4f5c\u6d41\u53ef\u89c6\u5316 (Workflow Visualization)","text":"<pre><code>sequenceDiagram\n    participant CN as \u63a7\u5236\u8282\u70b9 (Ansible)\n    participant MN as \u53d7\u63a7\u8282\u70b9 (Server A)\n\n    CN-&gt;&gt;MN: 1. SSH \u63e1\u624b\u4e0e\u8ba4\u8bc1\n    CN-&gt;&gt;MN: 2. \u53d1\u9001\u6a21\u5757\u4ee3\u7801 (SFTP)\n    Note over MN: ~/.ansible/tmp/xx.py\n    CN-&gt;&gt;MN: 3. \u6267\u884c\u6a21\u5757 (Python)\n    MN--&gt;&gt;MN: 4. \u72b6\u6001\u68c0\u67e5 (\u5e42\u7b49\u6027\u5224\u65ad)\n    MN--&gt;&gt;CN: 5. \u8fd4\u56de\u7ed3\u679c (JSON)\n    CN-&gt;&gt;MN: 6. \u5220\u9664\u4e34\u65f6\u6587\u4ef6</code></pre>"},{"location":"02-prerequisites/","title":"02-\u73af\u5883\u51c6\u5907 (Prerequisites)","text":""},{"location":"02-prerequisites/#1-control-node","title":"1. \u63a7\u5236\u8282\u70b9 (Control Node)","text":"<ul> <li>\u786c\u4ef6\u8981\u6c42:<ul> <li>CPU: 2 \u6838\u4ee5\u4e0a (\u5e76\u53d1\u8fde\u63a5\u4f1a\u6d88\u8017 CPU \u8d44\u6e90)</li> <li>RAM: 4GB \u4ee5\u4e0a (Ansible \u81ea\u8eab\u5f88\u8f7b\u91cf\uff0c\u4f46\u5927\u91cf Fork \u8fdb\u7a0b\u4f1a\u6d88\u8017\u5185\u5b58)</li> </ul> </li> <li>\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301:<ul> <li>\u2705 Linux (RHEL, CentOS, Ubuntu, Debian)</li> <li>\u2705 macOS</li> <li>\u274c Windows (\u539f\u751f\u4e0d\u652f\u6301\u4f5c\u4e3a\u63a7\u5236\u8282\u70b9\uff0c\u9700\u4f7f\u7528 WSL2)</li> </ul> </li> <li>\u8f6f\u4ef6\u4f9d\u8d56:<ul> <li>Python 3.8+ (\u6838\u5fc3\u8fd0\u884c\u65f6)</li> <li><code>pip</code> (\u5305\u7ba1\u7406\u5668)</li> </ul> </li> </ul>"},{"location":"02-prerequisites/#2-managed-nodes","title":"2. \u53d7\u63a7\u8282\u70b9 (Managed Nodes)","text":"<ul> <li>\u57fa\u672c\u8981\u6c42:<ul> <li>Python: Python 2.7+ \u6216 Python 3.5+\u3002Ansible \u7684\u6a21\u5757\u9700\u8981\u5728\u76ee\u6807\u673a\u4e0a\u8fd0\u884c Python \u4ee3\u7801\u3002<ul> <li>\u5e38\u89c1\u9519\u8bef\u6392\u67e5 (Troubleshooting): \u5982\u679c\u76ee\u6807\u673a\u662f\u6781\u7b80\u5bb9\u5668 (\u5982 Alpine)\uff0c\u9ed8\u8ba4\u6ca1\u6709 Python\uff0c\u9700\u4f7f\u7528 <code>raw</code> \u6a21\u5757\u5148\u5b89\u88c5 Python\u3002</li> </ul> </li> <li>SSH Server: \u786e\u4fdd <code>sshd</code> \u670d\u52a1\u5f00\u542f\u5e76\u5728\u76d1\u542c\uff08\u9ed8\u8ba4\u7aef\u53e3 22\uff09\u3002</li> <li>SFTP: \u9ed8\u8ba4\u4f9d\u8d56 SFTP \u4f20\u8f93\u6587\u4ef6\u3002\u5982\u679c <code>sshd_config</code> \u7981\u7528\u4e86 SFTP\uff0c\u9700\u914d\u7f6e Ansible \u4f7f\u7528 <code>scp</code> \u6a21\u5f0f\u3002</li> </ul> </li> </ul>"},{"location":"02-prerequisites/#3-connectivity-check","title":"3. \u8fde\u901a\u6027\u81ea\u68c0 (Connectivity Check)","text":"<pre><code># Ad-hoc \u4e34\u65f6\u547d\u4ee4\u6d4b\u8bd5\n# -m ping: \u8c03\u7528 ping \u6a21\u5757 (\u6ce8\u610f\uff1a\u8fd9\u4e0d\u662f ICMP ping\uff0c\u800c\u662f Python \u7ea7\u522b\u7684\u8fde\u901a\u6027\u6d4b\u8bd5)\n# -u root: \u6307\u5b9a\u4ee5 root \u7528\u6237\u8fde\u63a5\nansible all -m ping -u root\n</code></pre>"},{"location":"02-prerequisites/#troubleshooting","title":"\u5e38\u89c1\u9519\u8bef\u6392\u67e5 (Troubleshooting)","text":"<ul> <li><code>\"msg\": \"module configuration failed\"</code> -&gt; \u76ee\u6807\u673a\u7f3a\u5c11 Python \u73af\u5883\u3002</li> <li><code>\"msg\": \"Permission denied (publickey)\"</code> -&gt; SSH \u516c\u94a5\u672a\u6b63\u786e\u5206\u53d1 (<code>ssh-copy-id</code>)\u3002</li> </ul>"},{"location":"03-deep-dive/","title":"03-\u6df1\u5ea6\u89e3\u6790 (Deep Dive)","text":"<p>\u672c\u7ae0\u76ee\u6807: \u8df3\u51fa\u201c\u5982\u4f55\u4f7f\u7528\u201d\u7684\u8868\u5c42\uff0c\u6df1\u5165 Ansible \u7684\u5185\u6838\uff0c\u7406\u89e3\u4ece Inventory \u89e3\u6790\u5230 Module \u6267\u884c\u7684\u5b8c\u6574\u751f\u547d\u5468\u671f\u3002</p>"},{"location":"03-deep-dive/#1-inventory-variable-precedence","title":"1. \u6e05\u5355\u4e0e\u53d8\u91cf\u4f18\u5148\u7ea7 (Inventory &amp; Variable Precedence)","text":"<p>Ansible \u5982\u4f55\u77e5\u9053\u8be5\u64cd\u4f5c\u54ea\u4e9b\u4e3b\u673a\uff1f\u53d8\u91cf\u53d1\u751f\u51b2\u7a81\u65f6\u542c\u8c01\u7684\uff1f</p>"},{"location":"03-deep-dive/#11-static-vs-dynamic-inventory","title":"1.1 \u9759\u6001\u4e0e\u52a8\u6001\u6e05\u5355 (Static vs Dynamic Inventory)","text":"<ul> <li>\u9759\u6001\u6e05\u5355 (Static): \u7b80\u5355\u7684 <code>.ini</code> \u6216 <code>.yaml</code> \u6587\u4ef6\uff0c\u9002\u5408\u56fa\u5b9a\u67b6\u6784\u3002</li> <li>\u52a8\u6001\u6e05\u5355 (Dynamic): Python \u811a\u672c\u6216\u63d2\u4ef6\uff0c\u5b9e\u65f6\u67e5\u8be2\u4e91\u5382\u5546 API (AWS/Aliyun) \u6216 CMDB\uff0c\u83b7\u53d6\u4e3b\u673a\u5217\u8868\u3002</li> </ul>"},{"location":"03-deep-dive/#12-the-pyramid-of-precedence","title":"1.2 \u53d8\u91cf\u4f18\u5148\u7ea7\u91d1\u5b57\u5854 (The Pyramid of Precedence)","text":"<p>\u5f53\u540c\u4e00\u4e2a\u53d8\u91cf\u5728\u591a\u5904\u5b9a\u4e49\u65f6\uff0cAnsible \u9075\u5faa\u4e25\u683c\u7684\u8986\u76d6\u89c4\u5219\uff08\u7531\u4f4e\u5230\u9ad8\uff0c\u540e\u8005\u8986\u76d6\u524d\u8005\uff09\uff1a</p> <ol> <li>Role defaults (\u6700\u4f4e\u4f18\u5148\u7ea7)</li> <li>Inventory group_vars</li> <li>Inventory host_vars</li> <li>Playbook group_vars</li> <li>Playbook host_vars</li> <li>Play vars</li> <li>Task vars (\u6700\u9ad8\u4f18\u5148\u7ea7\uff0c\u9664\u4e86\u547d\u4ee4\u884c\u4f20\u53c2)</li> <li>Extra vars (<code>-e</code> \u547d\u4ee4\u884c\u53c2\u6570\uff0c\u7edd\u5bf9\u9738\u6743)</li> </ol> <p>\u6700\u4f73\u5b9e\u8df5: \u5c3d\u91cf\u5728 <code>group_vars</code> \u4e2d\u5b9a\u4e49\u901a\u7528\u53d8\u91cf\uff0c\u5728 <code>host_vars</code> \u4e2d\u5b9a\u4e49\u7279\u4f8b\uff0c\u907f\u514d\u6ee5\u7528 <code>-e</code> \u5bfc\u81f4\u8c03\u8bd5\u56f0\u96be\u3002</p>"},{"location":"03-deep-dive/#2-module-execution-lifecycle","title":"2. \u6a21\u5757\u6267\u884c\u5168\u94fe\u8def (Module Execution Lifecycle)","text":"<p>\u5f53\u4f60\u8fd0\u884c <code>ansible web -m ping</code> \u65f6\uff0c\u5e95\u5c42\u7a76\u7adf\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f</p> <pre><code>sequenceDiagram\n    participant Control as \u63a7\u5236\u8282\u70b9\n    participant SSH as SSH \u901a\u9053\n    participant Remote as \u8fdc\u7a0b\u8282\u70b9\n\n    Control-&gt;&gt;Control: 1. \u89e3\u6790 Inventory &amp; \u5339\u914d\u4e3b\u673a\n    Control-&gt;&gt;Control: 2. \u751f\u6210\u6a21\u5757\u4ee3\u7801 (Python Payload)\n    Note right of Control: \u5c06\u53c2\u6570\u6253\u5305\u8fdb JSON\uff0c\u62fc\u63a5\u5230\u6a21\u5757\u6e90\u7801\u4e2d\n    Control-&gt;&gt;SSH: 3. \u5efa\u7acb SSH \u8fde\u63a5 (ControlPersist)\n    SSH-&gt;&gt;Remote: 4. \u521b\u5efa\u4e34\u65f6\u76ee\u5f55 (~/.ansible/tmp/...)\n    SSH-&gt;&gt;Remote: 5. SFTP \u4e0a\u4f20 Payload\n    Control-&gt;&gt;Remote: 6. \u6267\u884c Payload (chmod +x &amp; python)\n    Remote-&gt;&gt;Remote: 7. \u6a21\u5757\u8fd0\u884c (\u6536\u96c6 Facts, \u6267\u884c\u903b\u8f91)\n    Remote--&gt;&gt;Control: 8. \u8fd4\u56de JSON \u7ed3\u679c (stdout)\n    Control-&gt;&gt;Remote: 9. \u6e05\u7406\u4e34\u65f6\u76ee\u5f55</code></pre>"},{"location":"03-deep-dive/#_1","title":"\u5173\u952e\u6280\u672f\u70b9\u89e3\u6790","text":"<ul> <li>Ansiballz: \u73b0\u4ee3 Ansible \u4f7f\u7528 \"Ansiballz\" \u6846\u67b6\uff0c\u5c06\u6a21\u5757\u53ca\u5176\u4f9d\u8d56\u6253\u5305\u6210\u4e00\u4e2a zip \u6587\u4ef6\uff0c\u901a\u8fc7 stdin \u4f20\u7ed9\u8fdc\u7a0b python \u89e3\u91ca\u5668\uff0c\u6781\u5927\u63d0\u5347\u4e86\u4f20\u8f93\u6548\u7387\u3002</li> <li>Shebang Injection: Ansible \u4f1a\u81ea\u52a8\u63a2\u6d4b\u8fdc\u7a0b python \u8def\u5f84\uff08\u5982 <code>/usr/bin/python3</code>\uff09\uff0c\u5e76\u66ff\u6362\u811a\u672c\u5934\u90e8\u7684 Shebang\u3002</li> </ul>"},{"location":"03-deep-dive/#3-privilege-escalation-become","title":"3. \u63d0\u6743\u673a\u5236 (Privilege Escalation: Become)","text":"<p>\u4e3a\u4ec0\u4e48\u5728 Playbook \u4e2d\u5199 <code>become: yes</code> \u5c31\u80fd\u7528 root \u6743\u9650\uff1f</p> <ul> <li>\u539f\u7406: Ansible \u4e0d\u4f1a\u76f4\u63a5\u4ee5 root \u767b\u5f55\uff08\u8fd9\u662f\u5b89\u5168\u5927\u5fcc\uff09\u3002\u5b83\u5148\u4ee5\u666e\u901a\u7528\u6237\u767b\u5f55\uff0c\u7136\u540e\u901a\u8fc7 <code>sudo</code> (\u9ed8\u8ba4)\u3001<code>su</code> \u6216 <code>doas</code> \u5207\u6362\u8eab\u4efd\u3002</li> <li>\u547d\u4ee4\u5305\u88c5:<ul> <li>\u539f\u59cb\u547d\u4ee4: <code>service nginx restart</code></li> <li>\u5305\u88c5\u540e: <code>sudo -H -S -n -u root /bin/sh -c '...'</code></li> </ul> </li> <li>Troubleshooting:<ul> <li>\u62a5\u9519 <code>Missing sudo password</code>: \u8fdc\u7a0b\u7528\u6237 sudo \u9700\u8981\u5bc6\u7801\uff0c\u4f46\u672a\u5728 Ansible \u4e2d\u914d\u7f6e (<code>--ask-become-pass</code>)\u3002</li> </ul> </li> </ul>"},{"location":"03-deep-dive/#4-strategy","title":"4. \u6267\u884c\u7b56\u7565 (Strategy)","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAnsible \u91c7\u7528 Linear (\u7ebf\u6027) \u7b56\u7565\uff1a\u6240\u6709\u4e3b\u673a\u5fc5\u987b\u5b8c\u6210 Task 1\uff0c\u624d\u80fd\u4e00\u8d77\u8fdb\u5165 Task 2\u3002</p> <ul> <li>Linear (\u9ed8\u8ba4): \u50cf\u9605\u5175\u4e00\u6837\u9f50\u5934\u5e76\u8fdb\u3002\u5982\u679c\u4e00\u53f0\u673a\u5668\u5361\u4f4f\uff0c\u6240\u6709\u673a\u5668\u7b49\u5f85\u3002</li> <li>Free (\u81ea\u7531): \u50cf\u8d5b\u8dd1\u4e00\u6837\uff0c\u6bcf\u53f0\u4e3b\u673a\u5c3d\u53ef\u80fd\u5feb\u5730\u8dd1\u5b8c\u6240\u6709 Task\uff0c\u4e92\u4e0d\u7b49\u5f85\u3002</li> <li>Serial (\u6eda\u52a8): <code>serial: 2</code> \u8868\u793a\u4e00\u6b21\u53ea\u64cd\u4f5c 2 \u53f0\u4e3b\u673a\uff0c\u9002\u5408\u751f\u4ea7\u73af\u5883\u7070\u5ea6\u53d1\u5e03 (Canary Deployment)\u3002</li> </ul>"},{"location":"04-tutorial/","title":"04-\u5206\u6b65\u5b9e\u6218\u6559\u7a0b (Step-by-Step Tutorial)","text":"<p>\u672c\u7ae0\u76ee\u6807: \u4ece\u96f6\u5f00\u59cb\uff0c\u90e8\u7f72\u4e00\u4e2a\u751f\u4ea7\u7ea7\u7684\u9ad8\u53ef\u7528 Nginx Web \u670d\u52a1\u5668\u3002\u6211\u4eec\u5c06\u4ece\u6700\u7b80\u5355\u7684 Ad-Hoc \u547d\u4ee4\u8fdb\u5316\u5230\u6a21\u5757\u5316\u7684 Roles \u7ed3\u6784\u3002</p>"},{"location":"04-tutorial/#scenario","title":"\u573a\u666f\u63cf\u8ff0 (Scenario)","text":"<ul> <li>\u76ee\u6807: \u5728\u4e00\u7ec4\u670d\u52a1\u5668\u4e0a\u5b89\u88c5 Nginx\uff0c\u63a8\u9001\u81ea\u5b9a\u4e49 <code>index.html</code>\uff0c\u5e76\u786e\u4fdd\u670d\u52a1\u5f00\u673a\u81ea\u542f\u3002</li> <li>\u73af\u5883:<ul> <li>\u63a7\u5236\u8282\u70b9: \u672c\u673a</li> <li>\u53d7\u63a7\u8282\u70b9: <code>server-a</code>, <code>server-b</code> (\u5047\u8bbe IP \u4e3a 192.168.1.10, 192.168.1.11)</li> </ul> </li> </ul>"},{"location":"04-tutorial/#step-1-inventory","title":"Step 1: \u5efa\u7acb\u4e3b\u673a\u6e05\u5355 (Inventory)","text":"<p>\u521b\u5efa <code>inventory.ini</code> \u6587\u4ef6\u3002\u6211\u4eec\u4f7f\u7528 INI \u683c\u5f0f\uff0c\u56e0\u4e3a\u5b83\u7b80\u5355\u76f4\u89c2\u3002</p> <pre><code>[webservers]\nserver-a ansible_host=192.168.1.10\nserver-b ansible_host=192.168.1.11\n\n[webservers:vars]\n# \u5b9a\u4e49\u8be5\u7ec4\u7684\u901a\u7528\u53d8\u91cf\nansible_user=ubuntu\nansible_ssh_private_key_file=~/.ssh/id_rsa\n</code></pre> <p>\u9a8c\u8bc1: <pre><code>ansible webservers -i inventory.ini -m ping\n</code></pre></p>"},{"location":"04-tutorial/#step-2-playbook","title":"Step 2: \u7f16\u5199\u7b2c\u4e00\u4e2a Playbook","text":"<p>\u521b\u5efa <code>site.yml</code>\u3002\u8fd9\u662f Ansible \u7684\u6838\u5fc3\u7f16\u6392\u6587\u4ef6\u3002</p> <pre><code>---\n- name: Deploy Nginx Web Server\n  hosts: webservers\n  become: yes  # \u9700\u8981 root \u6743\u9650\u5b89\u88c5\u8f6f\u4ef6\n\n  vars:\n    http_port: 80\n    server_name: \"My Awesome Site\"\n\n  tasks:\n    - name: Ensure Nginx is installed\n      apt:\n        name: nginx\n        state: present\n        update_cache: yes\n      # \u89e3\u91ca: state=present \u4fdd\u8bc1\u8f6f\u4ef6\u5df2\u5b89\u88c5 (\u5e42\u7b49\u6027)\n\n    - name: Deploy custom index.html\n      template:\n        src: templates/index.html.j2\n        dest: /var/www/html/index.html\n        mode: '0644'\n      notify: Restart Nginx\n      # \u89e3\u91ca: \u53ea\u6709\u5f53\u6587\u4ef6\u5185\u5bb9\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u624d\u4f1a\u89e6\u53d1 Handler\n\n    - name: Ensure Nginx is running and enabled\n      service:\n        name: nginx\n        state: started\n        enabled: yes\n\n  handlers:\n    - name: Restart Nginx\n      service:\n        name: nginx\n        state: restarted\n      # \u89e3\u91ca: Handlers \u53ea\u6709\u5728\u88ab notify \u65f6\u624d\u4f1a\u6267\u884c\uff0c\u4e14\u5728 Play \u6700\u540e\u7edf\u4e00\u6267\u884c\n</code></pre>"},{"location":"04-tutorial/#step-3-jinja2-templates","title":"Step 3: \u6a21\u677f\u5316\u914d\u7f6e (Jinja2 Templates)","text":"<p>\u521b\u5efa <code>templates/index.html.j2</code>\u3002\u4f7f\u7528 Jinja2 \u8bed\u6cd5\u52a8\u6001\u6ce8\u5165\u53d8\u91cf\u3002</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;{{ server_name }}&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;h1&gt;Welcome to {{ ansible_hostname }}&lt;/h1&gt;\n    &lt;p&gt;This server is managed by Ansible.&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <ul> <li><code>{{ server_name }}</code>: \u6765\u81ea Playbook \u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\u3002</li> <li><code>{{ ansible_hostname }}</code>: \u6765\u81ea Ansible \u81ea\u52a8\u6536\u96c6\u7684 Facts (\u7cfb\u7edf\u4e3b\u673a\u540d)\u3002</li> </ul>"},{"location":"04-tutorial/#step-4","title":"Step 4: \u6267\u884c\u4e0e\u9a8c\u8bc1","text":"<p>\u8fd0\u884c Playbook\uff1a</p> <pre><code>ansible-playbook -i inventory.ini site.yml\n</code></pre> <p>\u8f93\u51fa\u89e3\u8bfb: *   <code>PLAY [Deploy Nginx Web Server]</code>: \u5267\u672c\u5f00\u59cb\u3002 *   <code>TASK [Gathering Facts]</code>: \u81ea\u52a8\u6536\u96c6\u76ee\u6807\u673a\u4fe1\u606f\u3002 *   <code>TASK [Ensure Nginx is installed]</code>:     *   <code>changed</code>: \u7b2c\u4e00\u6b21\u8fd0\u884c\uff0c\u5b89\u88c5\u4e86\u8f6f\u4ef6\u3002     *   <code>ok</code>: \u7b2c\u4e8c\u6b21\u8fd0\u884c\uff0c\u68c0\u6d4b\u5230\u5df2\u5b89\u88c5\uff0c\u8df3\u8fc7\u3002 *   <code>RUNNING HANDLER [Restart Nginx]</code>: \u4ec5\u5728\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\u540e\u89e6\u53d1\u3002</p>"},{"location":"04-tutorial/#troubleshooting","title":"\u5e38\u89c1\u9519\u8bef\u6392\u67e5 (Troubleshooting)","text":"<ol> <li>YAML \u7f29\u8fdb\u9519\u8bef:<ul> <li>\u73b0\u8c61: <code>Syntax Error while loading YAML</code>.</li> <li>\u89e3\u51b3: \u786e\u4fdd\u4f7f\u7528 2 \u7a7a\u683c\u7f29\u8fdb\uff0c\u4e25\u7981\u4f7f\u7528 Tab \u952e\u3002</li> </ul> </li> <li>\u6743\u9650\u4e0d\u8db3:<ul> <li>\u73b0\u8c61: <code>apt: Permission denied</code>.</li> <li>\u89e3\u51b3: \u68c0\u67e5 <code>become: yes</code> \u662f\u5426\u5df2\u6dfb\u52a0\u3002</li> </ul> </li> </ol>"},{"location":"05-optimization/","title":"05-\u9ad8\u7ea7\u8c03\u4f18 (Advanced Optimization)","text":"<p>\u672c\u7ae0\u76ee\u6807: \u5f53\u4f60\u7684\u7ba1\u7406\u8282\u70b9\u4ece 10 \u53f0\u589e\u52a0\u5230 1000 \u53f0\u65f6\uff0c\u9ed8\u8ba4\u914d\u7f6e\u4f1a\u6162\u5982\u8717\u725b\u3002\u672c\u7ae0\u5c06\u4ecb\u7ecd\u8ba9 Ansible \u98de\u8d77\u6765\u7684\u6838\u5fc3\u8c03\u4f18\u6280\u5de7\u3002</p>"},{"location":"05-optimization/#1-ssh-pipelining","title":"1. SSH Pipelining (\u7ba1\u9053\u52a0\u901f)","text":"<p>\u8fd9\u662f\u63d0\u5347 Ansible \u6027\u80fd\u6700\u6709\u6548\u7684\u5355\u4e00\u8bbe\u7f6e\u3002</p> <ul> <li>\u539f\u7406:<ul> <li>\u9ed8\u8ba4\u6a21\u5f0f: SSH \u8fde\u63a5 -&gt; SFTP \u4e0a\u4f20\u811a\u672c -&gt; SSH \u8fde\u63a5 -&gt; \u6267\u884c\u811a\u672c -&gt; \u5220\u9664\u811a\u672c (\u591a\u6b21\u7f51\u7edc IO)\u3002</li> <li>Pipelining: \u5efa\u7acb\u4e00\u4e2a SSH \u4f1a\u8bdd\uff0c\u76f4\u63a5\u901a\u8fc7\u7ba1\u9053 (<code>|</code>) \u5c06 Python \u811a\u672c\u8f93\u5165\u5230\u8fdc\u7a0b\u89e3\u91ca\u5668\u6267\u884c\u3002\u51cf\u5c11\u4e86 SFTP \u8fde\u63a5\u548c\u6587\u4ef6\u5199\u5165\u5f00\u9500\u3002</li> </ul> </li> <li>\u914d\u7f6e (<code>ansible.cfg</code>):     <pre><code>[ssh_connection]\npipelining = True\n</code></pre></li> <li>\u524d\u63d0\u6761\u4ef6: \u76ee\u6807\u673a\u7684 <code>/etc/sudoers</code> \u914d\u7f6e\u4e2d\u4e0d\u80fd\u6709 <code>requiretty</code> (\u73b0\u4ee3 Linux \u53d1\u884c\u7248\u9ed8\u8ba4\u901a\u5e38\u6ca1\u6709)\u3002</li> </ul>"},{"location":"05-optimization/#2-forks","title":"2. \u5e76\u53d1\u63a7\u5236 (Forks)","text":"<p>Ansible \u9ed8\u8ba4\u4e00\u6b21\u53ea\u64cd\u4f5c 5 \u53f0\u4e3b\u673a (<code>forks = 5</code>)\u3002\u5bf9\u4e8e\u5927\u96c6\u7fa4\uff0c\u8fd9\u592a\u4fdd\u5b88\u4e86\u3002</p> <ul> <li>\u4f18\u5316: \u6839\u636e\u63a7\u5236\u8282\u70b9\u7684 CPU \u6838\u5fc3\u6570\uff0c\u9002\u5f53\u8c03\u5927\u3002     <pre><code>[defaults]\nforks = 50\n</code></pre></li> <li>\u6ce8\u610f: \u5185\u5b58\u6d88\u8017\u4f1a\u968f\u4e4b\u589e\u52a0\u3002</li> </ul>"},{"location":"05-optimization/#3-facts-gathering-facts","title":"3. \u5173\u95ed Facts \u6536\u96c6 (Gathering Facts)","text":"<p>\u6bcf\u6b21 Playbook \u8fd0\u884c\u524d\uff0cAnsible \u90fd\u4f1a\u50cf\u67e5\u6237\u53e3\u4e00\u6837\u6536\u96c6\u76ee\u6807\u673a\u7684 OS\u3001IP\u3001\u78c1\u76d8\u7b49\u4fe1\u606f\u3002\u8fd9\u975e\u5e38\u8017\u65f6\u3002</p> <ul> <li>\u7b56\u7565 1: \u663e\u5f0f\u5173\u95ed: \u5982\u679c\u4f60\u7684 Playbook \u4e0d\u4f9d\u8d56 <code>ansible_os_family</code> \u7b49\u53d8\u91cf\uff0c\u76f4\u63a5\u5173\u6389\u3002     <pre><code>- hosts: webservers\n  gather_facts: no\n</code></pre></li> <li>\u7b56\u7565 2: Facts \u7f13\u5b58 (Smart Gathering): \u6536\u96c6\u4e00\u6b21\uff0c\u7f13\u5b58 24 \u5c0f\u65f6 (Redis/JSON)\u3002     <pre><code>[defaults]\ngathering = smart\nfact_caching = jsonfile\nfact_caching_connection = /tmp/facts_cache\nfact_caching_timeout = 86400\n</code></pre></li> </ul>"},{"location":"05-optimization/#4-ssh-controlpersist","title":"4. SSH ControlPersist (\u957f\u8fde\u63a5)","text":"<p>\u590d\u7528 SSH \u8fde\u63a5\uff0c\u907f\u514d\u6bcf\u6b21\u6267\u884c Task \u90fd\u91cd\u65b0\u8fdb\u884c TCP \u63e1\u624b\u548c\u5bc6\u94a5\u4ea4\u6362\u3002</p> <ul> <li>\u914d\u7f6e:     <pre><code>[ssh_connection]\nssh_args = -o ControlMaster=auto -o ControlPersist=60s\n</code></pre></li> <li>\u6548\u679c: \u7b2c\u4e00\u6b21\u8fde\u63a5\u6162\uff0c\u540e\u7eed\u547d\u4ee4\u79d2\u7ea7\u54cd\u5e94\u3002</li> </ul>"},{"location":"05-optimization/#5-mitogen","title":"5. \u9488\u5bf9\u5927\u89c4\u6a21\u96c6\u7fa4\u7684 Mitogen","text":"<p>Mitogen \u662f\u4e00\u4e2a\u7b2c\u4e09\u65b9 Python \u5e93\uff0c\u5b8c\u5168\u91cd\u5199\u4e86 Ansible \u7684\u901a\u4fe1\u5c42\u3002 *   \u6548\u679c: CPU \u5360\u7528\u964d\u4f4e 50%\uff0c\u6267\u884c\u901f\u5ea6\u63d0\u5347 2-7 \u500d\u3002 *   \u9002\u7528\u573a\u666f: \u62e5\u6709\u6570\u5343\u53f0\u670d\u52a1\u5668\u7684\u8d85\u5927\u89c4\u6a21\u73af\u5883\u3002</p>"},{"location":"05-optimization/#_1","title":"\u8c03\u4f18\u6548\u679c\u5bf9\u6bd4\u8868","text":"\u4f18\u5316\u624b\u6bb5 \u9002\u7528\u573a\u666f \u9884\u671f\u63d0\u5347 \u98ce\u9669 Pipelining \u901a\u7528 \u2b50\u2b50\u2b50\u2b50\u2b50 \u9700\u68c0\u67e5 sudoers Forks \u4e3b\u673a\u6570 &gt; 10 \u2b50\u2b50\u2b50\u2b50 \u5185\u5b58\u6d88\u8017\u589e\u52a0 Fact Caching \u9891\u7e41\u8fd0\u884c \u2b50\u2b50\u2b50 \u6570\u636e\u53ef\u80fd\u8fc7\u671f ControlPersist \u8fde\u7eed Tasks \u591a \u2b50\u2b50\u2b50\u2b50 \u65e0"},{"location":"06-errors/","title":"06-\u9519\u8bef\u4ee3\u7801\u7d22\u5f15 (Error Reference)","text":"<p>\u672c\u7ae0\u76ee\u6807: \u9762\u5bf9\u7ea2\u8272\u7684\u62a5\u9519\u4fe1\u606f\u4e0d\u518d\u6050\u614c\u3002\u8fd9\u91cc\u6c47\u603b\u4e86 90% \u7684\u5e38\u89c1\u9519\u8bef\u53ca\u5176\u6839\u672c\u539f\u56e0\u3002</p>"},{"location":"06-errors/#1","title":"1. \u8c03\u8bd5\u4e09\u677f\u65a7","text":"<p>\u5728\u67e5\u9605\u9519\u8bef\u7801\u4e4b\u524d\uff0c\u5148\u638c\u63e1\u8c03\u8bd5\u5de5\u5177\uff1a</p> <ol> <li><code>-v</code> \u53c2\u6570: \u589e\u52a0\u8be6\u7ec6\u5ea6\u3002<ul> <li><code>-v</code>: \u663e\u793a\u7ed3\u679c\u3002</li> <li><code>-vv</code>: \u663e\u793a\u8f93\u5165\u8f93\u51fa\u3002</li> <li><code>-vvv</code>: \u663e\u793a SSH \u8fde\u63a5\u7ec6\u8282 (\u8fde\u63a5\u6392\u67e5\u795e\u5668)\u3002</li> </ul> </li> <li><code>debug</code> \u6a21\u5757: \u6253\u5370\u53d8\u91cf\u503c\u3002     <pre><code>- name: Print variable\n  debug:\n    var: my_variable\n</code></pre></li> <li>Check Mode (<code>--check</code>): \u6a21\u62df\u6267\u884c\uff0c\u4e0d\u8fdb\u884c\u5b9e\u9645\u4fee\u6539\u3002</li> </ol>"},{"location":"06-errors/#2-connection-issues","title":"2. \u8fde\u63a5\u7c7b\u9519\u8bef (Connection Issues)","text":""},{"location":"06-errors/#unreachable-msg-failed-to-connect-to-the-host-via-ssh","title":"<code>UNREACHABLE! =&gt; {\"msg\": \"Failed to connect to the host via ssh...\"}</code>","text":"<ul> <li>\u539f\u56e0 1: \u7f51\u7edc\u4e0d\u901a\u3002<ul> <li>\u6392\u67e5: <code>ping &lt;ip&gt;</code>\u3002</li> </ul> </li> <li>\u539f\u56e0 2: SSH \u670d\u52a1\u672a\u542f\u52a8\u6216\u7aef\u53e3\u4e0d\u5bf9\u3002<ul> <li>\u6392\u67e5: <code>telnet &lt;ip&gt; 22</code>\u3002</li> </ul> </li> <li>\u539f\u56e0 3: \u5bc6\u94a5\u8ba4\u8bc1\u5931\u8d25 (<code>Permission denied (publickey)</code>).<ul> <li>\u89e3\u51b3: \u8fd0\u884c <code>ssh-copy-id user@host</code> \u6216\u68c0\u67e5 <code>ansible_ssh_private_key_file</code> \u8def\u5f84\u3002</li> </ul> </li> </ul>"},{"location":"06-errors/#host-key-verification-failed","title":"<code>Host key verification failed</code>","text":"<ul> <li>\u539f\u56e0: \u76ee\u6807\u4e3b\u673a\u7684\u6307\u7eb9 (Fingerprint) \u4e0d\u5728\u63a7\u5236\u673a\u7684 <code>~/.ssh/known_hosts</code> \u4e2d\uff0c\u6216\u8005\u53d1\u751f\u4e86\u53d8\u5316\uff08\u91cd\u88c5\u7cfb\u7edf\uff09\u3002</li> <li>\u89e3\u51b3:<ul> <li>\u4e34\u65f6: <code>export ANSIBLE_HOST_KEY_CHECKING=False</code></li> <li>\u6c38\u4e45 (<code>ansible.cfg</code>): <code>host_key_checking = False</code></li> </ul> </li> </ul>"},{"location":"06-errors/#3","title":"3. \u6743\u9650\u4e0e\u6267\u884c\u7c7b\u9519\u8bef","text":""},{"location":"06-errors/#missing-sudo-password","title":"<code>Missing sudo password</code>","text":"<ul> <li>\u539f\u56e0: Playbook \u4e2d\u5f00\u542f\u4e86 <code>become: yes</code>\uff0c\u4f46 <code>sudo</code> \u6267\u884c\u9700\u8981\u5bc6\u7801\uff0c\u4e14\u672a\u63d0\u4f9b\u3002</li> <li>\u89e3\u51b3: \u8fd0\u884c\u547d\u4ee4\u65f6\u52a0 <code>-K</code> (\u5373 <code>--ask-become-pass</code>)\u3002</li> </ul>"},{"location":"06-errors/#binsh-usrbinpython-no-such-file-or-directory","title":"<code>/bin/sh: /usr/bin/python: No such file or directory</code>","text":"<ul> <li>\u539f\u56e0: \u76ee\u6807\u673a\u672a\u5b89\u88c5 Python\uff0c\u6216\u8005 Python \u8def\u5f84\u4e0d\u5728\u6807\u51c6\u4f4d\u7f6e\uff08\u5982 Python 3 \u5b89\u88c5\u5728 <code>/usr/bin/python3</code>\uff0c\u4f46 Ansible \u9ed8\u8ba4\u627e <code>python</code>\uff09\u3002</li> <li>\u89e3\u51b3: \u8bbe\u7f6e\u53d8\u91cf <code>ansible_python_interpreter=/usr/bin/python3</code>\u3002</li> </ul>"},{"location":"06-errors/#4","title":"4. \u8bed\u6cd5\u4e0e\u903b\u8f91\u9519\u8bef","text":""},{"location":"06-errors/#syntax-error-while-loading-yaml","title":"<code>Syntax Error while loading YAML</code>","text":"<ul> <li>\u539f\u56e0: \u7f29\u8fdb\u9519\u8bef\uff0c\u6216\u8005\u4f7f\u7528\u4e86 Tab \u952e\u3002YAML \u5bf9\u7f29\u8fdb\u6781\u5176\u654f\u611f\u3002</li> <li>\u6392\u67e5: \u4f7f\u7528 IDE (VS Code) \u7684 YAML \u63d2\u4ef6\u8fdb\u884c\u683c\u5f0f\u5316\u3002</li> </ul>"},{"location":"06-errors/#the-task-includes-an-option-with-an-undefined-variable","title":"<code>The task includes an option with an undefined variable</code>","text":"<ul> <li>\u539f\u56e0: \u5f15\u7528\u4e86\u4e0d\u5b58\u5728\u7684\u53d8\u91cf <code>{{ my_var }}</code>\u3002</li> <li>\u89e3\u51b3: \u68c0\u67e5\u53d8\u91cf\u540d\u62fc\u5199\uff0c\u6216\u4f7f\u7528 <code>default</code> \u8fc7\u6ee4\u5668: <code>{{ my_var | default('value') }}</code>\u3002</li> </ul>"},{"location":"06-errors/#5-error-handling","title":"5. \u9519\u8bef\u5904\u7406\u7b56\u7565 (Error Handling)","text":"<p>\u6709\u65f6\u5019\u6211\u4eec\u5e0c\u671b\u5ffd\u7565\u9519\u8bef\u7ee7\u7eed\u6267\u884c\uff1a</p> <ul> <li><code>ignore_errors: yes</code>: \u5373\u4f7f\u5f53\u524d Task \u5931\u8d25\uff0c\u7ee7\u7eed\u6267\u884c\u4e0b\u4e00\u4e2a Task\u3002</li> <li><code>failed_when</code>: \u81ea\u5b9a\u4e49\u5931\u8d25\u6761\u4ef6\u3002     <pre><code>- command: /bin/my_script\n  register: result\n  failed_when: \"'CRITICAL' in result.stdout\"\n</code></pre></li> <li><code>changed_when</code>: \u81ea\u5b9a\u4e49\u4f55\u65f6\u6807\u8bb0\u4e3a \"Changed\" (\u4fdd\u6301\u5e42\u7b49\u6027)\u3002     <pre><code>- command: /bin/install_something\n  register: result\n  changed_when: \"'Installed successfully' in result.stdout\"\n</code></pre></li> </ul>"}]}